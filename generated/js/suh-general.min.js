angular.module("SuhGeneral",[]),angular.module("SuhGeneral").provider("shApplicationData",[function(){var e={},t={get:function(t){return t?e[t]:e},set:function(t,r){if(angular.isObject(t))angular.forEach(t,function(t,r){e[t]=r});else{if(!angular.isString(t))throw new Error("Provided key is neither an object literal nor a string");e[t]=r}}};this.setData=function(t){e=t},this.setExtensions=function(e){for(var r in e)t[r]=angular.bind(t,e[r])},this.$get=[function(){var r=function(){Object.defineProperty(this,"data",{get:function(){return e}})};return r.prototype=t,new r}]}]),angular.module("SuhGeneral").factory("Cache",["shEventGenerator","shStorage","shUtil",function(e,t,r){var n=function(e){this.data={},this.key=e,this.enabled=!0,t.isEnabled()&&this.restore()};return r.extend(n,e,{store:function(e,t){var r=this;if(this.enabled){if(angular.isArray(e))return void angular.forEach(e,function(e,t){r.data[e.key]=r.data[e.value]});angular.isObject(e)?r.data[e.key]=e.value:r.data[e]=t}},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},persist:function(){this.enabled&&t.store(this.key,this.data)},restore:function(){this.enabled=!1;var e=t.getJSON(this.key);this.data=null!==e&&"undefined"!=typeof e&&angular.isObject(e)?e:{},this.enabled=!0},get:function(e){if(this.enabled){var t=this.data[e];return"undefined"!=typeof t&&null!==t?this.data[e]:null}}}),function(e){return new n(e)}}]),angular.module("SuhGeneral").factory("shDeferredRequest",["$q","$http","shSuccess","shError",function(e,t,r,n){return function(i,s,u,o,a,h,c){var l=e.defer(),f=h||r,p=c||n;return"undefined"!=typeof o&&("undefined"!=typeof o.success&&angular.isFunction(o.success)&&(f=o.success),"undefined"!=typeof o.error&&angular.isFunction(o.error)&&(p=o.error)),"get"===i.toLowerCase()||"undefined"==typeof u?t[i](s).success(f(l)).error(p(l)):t[i](s,u).success(f(l)).error(p(l)),l.promise}}]),angular.module("SuhGeneral").factory("shError",[function(){return function(e){return function(t){e.reject([{code:69905,description:"Network error"}])}}}]),angular.module("SuhGeneral").factory("shEventGenerator",["shUtil",function(e){var t=function(){this._listeners={}};return t.prototype={_register:function(e){this._listeners[e]=this.listeners[e]||[]},_unRegister:function(e){delete this._listeners[e]},trigger:function(e,t){this.listeners[e]&&angular.forEach(this.listeners[e],function(e){e(t)})},on:function(t,r,n,i){if(!this.listeners[t])throw new Error("Event: No such event");this.listeners[t].push(e.proxy(r,n,i))}},{Generator:t}}]),angular.module("SuhGeneral").factory("shEventsManager",["$rootScope","shIdentityGenerator","shException",function(e,t,r){var n=function(){this._e={}};return n.prototype={addListener:function(e){if(e.listenEvents){var t,r=e.listenEvents(),n=0,i=r.length;for(n=0;i>n;n++)t=r[n],this._e[t]=this._e[t]||[],this._e[t].push(e)}},removeListener:function(e,t){if(e.listenEvents)if(t&&this._e[t]){var r=this._e[t].indexOf(e);this._e[t].splice(r,1)}else for(var n,i=e.listenEvents(),r=0,s=i.length;s>r;r++)this._e[i[r]]&&-1!==(n=this._e[i[r]].indexOf(e))&&(this._e[i[r]].splice(n,1),r--,s--)},trigger:function(e,t){if(this._e[e])for(var r=0,n=this._e[e].length||0;n>r;r++)this._e[e][r]?this._e[e][r].fire(e,t):(this._e[e].splice(r,1),r--,n--)}},new n}]),angular.module("SuhGeneral").factory("shException",[function(){var e=function(e,t){this._code=e,this._desc=t};return e.prototype={code:function(){return this._code},description:function(){return this._desc},toString:function(){return"Error with code: "+this._code+" has occured.\n"+this._desc}},function(t,r){return new e(t,r)}}]),angular.module("SuhGeneral").factory("shHttpModel",["shHttp",function(e){return function(t){var r=function(){e.call(this,t)};return inherits(r,e),new r}}]),angular.module("SuhGeneral").factory("shHttp",["$q","shDeferredRequest","shHttpQuery","shUtil",function(e,t,r,n){var i=function(e,t){this.model=e,this.resource=n.string.toCamelCase(e),this._fields=t,this._url="/"+e+"/:id",this._extUrl="/"+e+"-:p-:c/:orderBy-:direction/:method/:id",this._queryUrl="/"+e+"/search"},s=i.prototype;return s.prepareUrl=function(e,t,r,n,i,s){var u=r||0,o=n||20,a=i||"id",h=s||"asc";return this._extUrl.replace(/:method/,e).replace(/:id/,t).replace(/:p/,u).replace(/:c/,o).replace(/:orderBy/,a).replace(/:direction/,h).replace(/\/$/,"")},s.postUrl=function(e,t,r){var n=r||"";return this._postUrl.replace(/:mid/,e).replace(/:object/,t).replace(/:oid/,n).replace(/\/$/,"").replace(/\/$/,"")},s.fields=function(){this._fields},s.createLocalObject=function(e){for(var t=e||{},r={},n=[],i="",s=0;s<this._fields.length;s++)if(i=this._fields[s],n=i.split(":"),n.length<3)r[n[0].toCamelCase()]=0==t[n[0]]?0:t[n[0]]||n[1]||"";else switch(n[1]){case"int":r[n[0].toCamelCase()]=t[n[0]]||parseInt(n[2])||0;break;case"float":r[n[0].toCamelCase()]=t[n[0]]||parseFloat(n[2])||0;break;case"json":r[n[0].toCamelCase()]=t[n[0]]||JSON.parse(n[2])||{};break;default:r[n[0].toCamelCase()]=t[n[0]]||n[2]||""}return r},s.createRemoteObject=function(e){for(var t=e||{},r={},n="",i=0;i<this._fields.length;i++)n=this._fields[i],r[n]=t[n.toCamelCase()]||"";return r},s.get=function(e){return t.call(this,"get",this._url.replace(/:id/,e))},s.getAll=function(e){return t.call(this,"post",this.prepareUrl("get-all",""),{ids:e})},s.getByAuth=function(){return t.call(this,"get",this._url.replace(/:id/,"auth"))},s.post=function(e,r,n,i){return t.call(this,"post",this.postUrl(e,r,n),i)},s.update=function(e,r){return t.call(this,"put",this._url.replace(/:id/,e),r)},s.search=function(e,r,n){return t.call(this,"post",this._queryUrl,{query:e,page:r,chunk:n})},s.by=function(e,r,n,i){return t.call(this,"get",this.prepareUrl(e,r,n,i))},s.byMethod=function(e,r){return t.call(this,"post",this._url.replace(/:id/,e),r)},s.kill=function(e){return angular.isArray(e)?t.call(this,"post",this._url.replace(/:id/,"kill"),{ids:e}):t.call(this,"delete",this._url.replace(/:id/,e))},s.create=function(e){return t.call(this,"post",this._url.replace(/:id/,"create"),e)},s.byAny=function(e){return t.call(this,"post",this._url.replace(/:id/,"any"),e)},s.index=function(e,r){return t.call(this,"post",this._url.replace(/:id/,"index"),{page:e,chunk:r})},s.select=function(e,r){return t.call(this,"post",this._url.replace(/:id/,"select"),{page:e,chunk:r})},s.query=function(e,t){return r(this.model)},i}]),angular.module("SuhGeneral").factory("shHttpPostQuery",["shDeferredRequest",function(e){var t=function(e){this._query={},this._orderBy=[],this._url="/"+e+"/post-query"},r=t.prototype;return r.by=function(e){return this._query.method=e,this},r.byId=function(e){return this._query.methodParam=e,this},r.orderBy=function(e,t){return this._query.orderBy=this._query.orderBy||[],this._query.orderBy.push([e,t]),this},r.where=function(e,t,r){switch(this._query.where=this._query.where||{},arguments.length){case 2:this._query.where[e]=["=",r];break;case 3:this._query.where[e]=[t,r]}return this},r.whereBetween=function(e,t,r){return this._query.whereBetween=this._query.whereBetween||{},3==arguments.length&&(this._query.whereBetween[e]=[t,r]),this},r.whereIn=function(e,t){return this._query.whereIn=this._query.whereIn||{},2==arguments.length&&(this._query.whereIn[e]=t),this},r.page=function(e){return this._query.page=e,this},r.chunk=function(e){return this._query.chunk=e,this},r.send=function(){return this._query.page=this._query.page||0,this._query.chunk=this._query.chunk||20,e("post",url,this._query)},function(e){return new t(e)}}]),angular.module("SuhGeneral").factory("shHttpQuery",["shDeferredRequest",function(e){var t=function(e){this._orderBy=[],this._url="/"+e+"/search"},r=t.prototype;return r.by=function(e){return this._method=e,this},r.byId=function(e){return this._methodParam=e,this},r.orderBy=function(e,t){var r=t||"asc";return this._orderBy.push(e+":"+r),this},r.where=function(e,t,r){return this._where=this._where||[],"undefined"!=typeof t&&"undefined"!=typeof r?this._where.push([e,t,r]):"undefined"!=typeof t&&this._where.push([e,"=",t]),this},r.orWhere=function(e,t,r){return this._orWhere=this._orWhere||[],"undefined"!=typeof t&&"undefined"!=typeof r?this._orWhere.push([e,t,r]):"undefined"!=typeof t&&this._orWhere.push([e,"=",t]),this},r.whereBetween=function(e,t,r){return this._where=this._where||[],"undefined"!=typeof t&&"undefined"!=typeof r&&this._where.push([e,"between",t,r]),this},r.whereIn=function(e,t){return this._where=this._where||[],"undefined"!=typeof t&&this._where.push([e,"in",t]),this},r.page=function(e){return this._url=this._url.replace(/:p/,e),this},r.chunk=function(e){return this._url=this._url.replace(/:c/,e),this},r.send=function(){var t=this._url;t.lastIndexOf("/")===t.length-1&&(t=t.substr(0,t.length-1));var r=this._where||[],n=this._orWhere||[];return e("post",t,{method:{name:this._method,param:this._methodParam},where:r,orWhere:n,orderBy:this._orderBy})},function(e){return new t(e)}}]),angular.module("SuhGeneral").factory("shIdentityGenerator",[function(){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,r="x"==e?t:3&t|8;return r.toString(16)})}}]),angular.module("SuhGeneral").factory("shLocationListener",["$location","shException",function(e,t){var r=function(){this._observers=[],this._parts=e.path().match(/[a-zA-Z0-9\-]+/g)};return r.prototype={register:function(e){if(-1===this._observers.indexOf(e)){if("undefined"==typeof e.onLocationChange)throw t(1,"Observer does not implement onLocationChange").toString();this._observers.push(e)}},unregister:function(e){var t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)},_process:function(){if(this._parts=e.path().match(/[a-zA-Z0-9\-]+/g),null!==this._parts&&this._parts.length>0)for(var t=0;t<this._observers.length;t++)this._observers[t].onLocationChange(this._parts[0],this._parts)},get:function(){return this._parts}},new r}]),angular.module("SuhGeneral").factory("shSharedDataRepository",[function(){var e=function(){this.repo={}};return e.prototype={set:function(e,t,r){return this.repo[e]=this.repo[e]||{},this.repo[e][dk]=r,this},get:function(e,t){return this.exists(e,t)?this.repo[e][t]:void 0},exists:function(e,t){return angular.isDefined(this.repo[e])&&angular.isDefined(this.repo[e][t])}},new e}]),angular.module("SuhGeneral").factory("shStorage",[function(){var e=!1,t={isEnabled:function(){return e},store:function(t,r){if(e){if(angular.isObject(t))for(var n in t)localStorage.setItem(n,angular.isObject(t[n])?JSON.stringify(t[n]):t[n]);else localStorage.setItem(t,angular.isObject(t[n])?JSON.stringify(r):t[n]);return!0}return!1},remove:function(t){e&&(angular.isObject(t)?angular.forEach(t,function(e,t){localStorage.removeItem(t)}):localStorage.removeItem(t))},get:function(t){if(e){var r=localStorage.getItem(t);r&&JSON.parse(r)}},_getType:function(t,r){if(!e)return null;var n=localStorage.getItem(t);return null!==n?r(n):void 0},getInteger:function(e){return t._getType(e,parseInt)},getFloat:function(e){return t._getType(e,parseFloat)},getJSON:function(e){return t._getType(e,JSON.parse)}};return t}]),angular.module("SuhGeneral").factory("shSuccess",[function(){return function(e){return function(t){return t.status?e.resolve(t.result):e.reject(t.reasons)}}}]),angular.module("SuhGeneral").factory("shUrlInspector",["shUrlRules",function(e){var t=document.URL,r={activeRule:null,pieces:[],mode:"view",id:-1,object:null};return{parse:function(){for(var n=0,i=e.rules(),s=i.length,u=null,o=0,a=0;s>n;n++)if(u=t.match(i[n].rule),"undefined"!=typeof u&&null!==u)for(a=i[n].pieces.length;a>o;o++){var h=i[n].pieces[o].split(":");r[h[0]]=u[o+1]||h[1]}r.id=parseInt(r.id)},mode:function(){return r.mode},id:function(){return parseInt(r.id)},object:function(){return r.object}}}]),angular.module("SuhGeneral").factory("shUrlRules",[function(){var e=[{rule:/\/(experience|guide|user)-[a-z\-0-9]+-([0-9]+)/,pieces:["object","id","mode:view"]},{rule:/\/me/,pieces:["object:user","id:-1","mode:edit"]},{rule:/\/(experiencebox|guidebox)\/([0-9]+)/,pieces:["object","id"]},{rule:/\/(guide|experience)\/(edit|preview|pdf|embed|box)\/([0-9]*)/,pieces:["object","mode","id"]},{rule:/\/(guide|experience)\/(create)/,pieces:["object","mode"]}];return{rules:function(){return e}}}]),angular.module("SuhGeneral").factory("shUtil",[function(){var e={extend:function(e,t,r){e.prototype=t.prototype,e.prototype.constructor=t,r&&(e.prototype=angular.extend({},e.prototype,r))},proxy:function(e,t){var r=t||this,n=arguments.length>2?Array.prototype.slice.call(agruments,2):[];return function(){var t=Array.prototype.slice.call(arguments,0);return e.apply(r,[].concat(n,t))}},format:function(e,t,r){var n,i;return n=angular.isString(this)?this.slice(0):e,i=angular.isString(this)?e:t,prefix=angular.isString(this)?t:r?r:":$",i&&angular.forEach(i,function(e,t){n=n.replace(angular.isString(t)?prefix.replace(/\$/,t):"?",e)}),n},map:function(e,t){var r=angular.isArray(e)?[]:angular.isObject(e)?[]:"";for(var n in e)r[n]=t(e[n]);return r},string:{toCamelCase:function(t){var r=t.match(/[^\-\_\.]+/g);return r&&r.length>1?r[0].toLowerCase()+e.map(r.slice(1),function(e){return e[0].toUpperCase()+e.slice(1)}).join(""):r[0].toLowerCase()},capitalize:function(e){if(!angular.isString(e))throw new Error("invalid parameter passed, expecting a string");return e.length>1?e[0].toUpperCase()+e.slice(1):e.toUpperCase()}}};return e}]),angular.module("SuhGeneral").factory("SuhGeneral.Validator",[function(){var e=function(e,t,r){this._fields=e,this._rules=t,this._messages=r,this._errors={}};return e.prototype={fails:function(){var e=!0;for(var t in this._fields){var r=this._rules[t];for(var n in r)e=e&&this._parse()}return e},error:function(e){return this._errors.getAt(e)},rules:{between:function(e,t,r){return e>=t&&r>=e},less:function(e,t){return t>e},greater:function(e,t){return e>t},not:function(e,t){return e!=t},notnull:function(e){return null!==e},"in":function(e,t){var r=JSON.parse(t);return-1!==r.indexOf(e)},string:function(e){return angular.isString(e)}},_parse:function(e,t,r){var n=r.match(/[^\:]/gi);if(null!==n){var i=n.shift();return this._errors[e]=this._errors[e]||{},this._errors[e][i]=this.rules[i].apply(this,[t].concat(n))}}},function(t,r,n){return new e(t,r,n)}}]);