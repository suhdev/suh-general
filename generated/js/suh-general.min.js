angular.module("SuhGeneral",[]),angular.module("SuhGeneral").directive("shLocalize",["shLocalizer",function(e){return{restrict:"A",scope:!1,link:function(t,r,n){if(angular.isDefined(n.shLocalize)){var i=e.get(n.shLocalize);i?r.html(i):e.ready().then(function(){var t=e.get(n.shLocalize);r.html(t?t:n.shLocalize)})}}}}]),angular.module("SuhGeneral").directive("shLocalizeAttr",["shLocalize",function(e){return{restrict:"A",scope:{},compile:function(t,r){var n,i,o=/^shLocalizeAttr(.+)/;angular.forEach(r.$attr,function(s,u){n=u.match(o),n&&n.length>1&&(i=e.get(r[u]),i?t.attr(n[1].toLowerCase(),i):e.ready().then(function(){var i=e.get(r[u]);i?t.attr(n[1].toLowerCase(),i):t.attr(r[u])}))})},link:function(e,t,r){console.log(r)}}}]),angular.module("SuhGeneral").provider("shApplicationData",[function(){var e={},t={get:function(t){return t?e[t]:e},set:function(t,r){if(angular.isObject(t))angular.forEach(t,function(t,r){e[t]=r});else{if(!angular.isString(t))throw new Error("Provided key is neither an object literal nor a string");e[t]=r}}};this.setData=function(t){e=t},this.setExtensions=function(e){for(var r in e)t[r]=angular.bind(t,e[r])},this.$get=[function(){var r=function(){Object.defineProperty(this,"data",{get:function(){return e}})};return r.prototype=t,new r}]}]),angular.provider("shUrlRules",[function(){var e=[{rule:/\/(experience|guide|user)-[a-z\-0-9]+-([0-9]+)/,pieces:["object","id","mode:view"]},{rule:/\/me/,pieces:["object:user","id:-1","mode:edit"]},{rule:/\/(experiencebox|guidebox)\/([0-9]+)/,pieces:["object","id"]},{rule:/\/(guide|experience)\/(edit|preview|pdf|embed|box)\/([0-9]*)/,pieces:["object","mode","id"]},{rule:/\/(guide|experience)\/(create)/,pieces:["object","mode"]}];this.setRules=function(t){e=t},this.$get=[function(){return{rules:function(){return e}}}]}]),angular.module("SuhGeneral").factory("shBlockNavigation",[function(){var e=function(e){window.onbeforeunload=function(){return e||"Are you sure you want to leave? you may lose any unsaved work"}},t=function(){window.onbeforeunload=void 0};return{block:e,unblock:t}}]),angular.module("SuhGeneral").factory("Cache",["shEventEmitter","shStorage","shUtil",function(e,t,r){var n=function(e,r){this.data={},this.key=e,this.enabled=!0,this.persistence=r||t,t.isEnabled()&&this.restore()};Util.inherits(n,_EG);var i=n.prototype;return i.store=function(e,t){var r=this;if(this.enabled){if(angular.isArray(e))return void angular.forEach(e,function(e,t){r.data[e.key]=r.data[e.value]});angular.isObject(e)?r.data[e.key]=e.value:r.data[e]=t}},i.disable=function(){this.enabled=!1},i.enable=function(){this.enabled=!0},i.persist=function(){this.enabled&&t.store(this.key,this.data)},i.restore=function(){this.enabled=!1;var e=t.getJSON(this.key);this.data=null!==e&&"undefined"!=typeof e&&angular.isObject(e)?e:{},this.enabled=!0},i.get=function(e){if(this.enabled){var t=this.data[e];return"undefined"!=typeof t&&null!==t?this.data[e]:null}},function(e){return new n(e)}}]),angular.module("SuhGeneral").factory("shDeferredRequest",["$q","$http","shSuccess","shError",function(e,t,r,n){return function(i,o,s,u,a,h,c){var l=e.defer(),f=h||r,d=c||n;return"undefined"!=typeof u&&("undefined"!=typeof u.success&&angular.isFunction(u.success)&&(f=u.success),"undefined"!=typeof u.error&&angular.isFunction(u.error)&&(d=u.error)),"get"===i.toLowerCase()||"undefined"==typeof s?t[i](o).success(f(l)).error(d(l)):t[i](o,s).success(f(l)).error(d(l)),l.promise}}]),angular.module("SuhGeneral").factory("shError",[function(){return function(e){return function(t){e.reject([{code:69905,description:"Network error"}])}}}]),angular.module("SuhGeneral").factory("shEventEmitter",[function(){function e(e){this.events=e||[],this.listeners={}}return e.prototype={addEventListener:function(e,t,r){if(-1===this.events.indexOf(e))throw new Error('The object does not support the event "'+evt+'".');this.listeners=this.listeners||{},this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(r?angular.bind(r,t):t)},removeEventListener:function(e,t){if(!this.listeners[e])throw new Error("Event '"+e+"' is not registered.");var r=this.listeners[e].indexOf(t);-1!==r&&this.listeners.splice(r,1)},trigger:function(e,t){if(this.listeners[e]){var r,n,i=this.listeners[e];for(r=0,n=i.length;n>r;r++)i[r](t)}},on:function(e,t,r){return this.addEventListener(e,t,r)}},e}]),angular.module("SuhGeneral").factory("shEventsManager",[function(){var e=function(){this._e={}};return e.prototype={addListener:function(e){if(e.listenEvents){var t,r=e.listenEvents(),n=0,i=r.length;for(n=0;i>n;n++)t=r[n],this._e[t]=this._e[t]||[],this._e[t].push(e)}},removeListener:function(e,t){if(e.listenEvents){var r;if(t&&this._e[t])r=this._e[t].indexOf(e),this._e[t].splice(r,1);else{var n,i=e.listenEvents(),o=i.length;for(r=0;o>r;r++)this._e[i[r]]&&-1!==(n=this._e[i[r]].indexOf(e))&&(this._e[i[r]].splice(n,1),r--,o--)}}},trigger:function(e,t){if(this._e[e])for(var r=0,n=this._e[e].length||0;n>r;r++)this._e[e][r]?this._e[e][r].fire(e,t):(this._e[e].splice(r,1),r--,n--)}},new e}]),angular.module("SuhGeneral").factory("shException",[function(){var e=function(e,t){this._code=e,this._desc=t};return e.prototype={code:function(){return this._code},description:function(){return this._desc},toString:function(){return"Error with code: "+this._code+" has occured.\n"+this._desc}},function(t,r){return new e(t,r)}}]),angular.module("SuhGeneral").factory("shHttpModel",["shHttp","shUtil",function(e,t){return function(r){var n=function(){e.call(this,r)};return t.inherits(n,e),new n}}]),angular.module("SuhGeneral").factory("shHttp",["$q","shDeferredRequest","shHttpQuery","shUtil",function(e,t,r,n){var i=function(e,t){this.model=e,this.resource=n.capitalize(n.toCamelCase(e)),this._fields=t,this._url="/"+e+"/:id",this._extUrl="/"+e+"-:p-:c/:orderBy-:direction/:method/:id",this._queryUrl="/"+e+"/search"},o=i.prototype;return o.prepareUrl=function(e,t,r,n,i,o){var s=r||0,u=n||20,a=i||"id",h=o||"asc";return this._extUrl.replace(/:method/,e).replace(/:id/,t).replace(/:p/,s).replace(/:c/,u).replace(/:orderBy/,a).replace(/:direction/,h).replace(/\/$/,"")},o.postUrl=function(e,t,r){var n=r||"";return this._postUrl.replace(/:mid/,e).replace(/:object/,t).replace(/:oid/,n).replace(/\/$/,"").replace(/\/$/,"")},o.fields=function(){return this._fields},o.createLocalObject=function(e){for(var t=e||{},r={},n=[],i="",o=0;o<this._fields.length;o++)if(i=this._fields[o],n=i.split(":"),n.length<3)r[n[0].toCamelCase()]=0===t[n[0]]?0:t[n[0]]||n[1]||"";else switch(n[1]){case"int":r[n[0].toCamelCase()]=t[n[0]]||parseInt(n[2])||0;break;case"float":r[n[0].toCamelCase()]=t[n[0]]||parseFloat(n[2])||0;break;case"json":r[n[0].toCamelCase()]=t[n[0]]||JSON.parse(n[2])||{};break;default:r[n[0].toCamelCase()]=t[n[0]]||n[2]||""}return r},o.createRemoteObject=function(e){for(var t=e||{},r={},n="",i=0;i<this._fields.length;i++)n=this._fields[i],r[n]=t[n.toCamelCase()]||"";return r},o.get=function(e){return t.call(this,"get",this._url.replace(/:id/,e))},o.getAll=function(e){return t.call(this,"post",this.prepareUrl("get-all",""),{ids:e})},o.getByAuth=function(){return t.call(this,"get",this._url.replace(/:id/,"auth"))},o.post=function(e,r,n,i){return t.call(this,"post",this.postUrl(e,r,n),i)},o.update=function(e,r){return t.call(this,"put",this._url.replace(/:id/,e),r)},o.search=function(e,r,n){return t.call(this,"post",this._queryUrl,{query:e,page:r,chunk:n})},o.by=function(e,r,n,i){return t.call(this,"get",this.prepareUrl(e,r,n,i))},o.byMethod=function(e,r){return t.call(this,"post",this._url.replace(/:id/,e),r)},o.kill=function(e){return angular.isArray(e)?t.call(this,"post",this._url.replace(/:id/,"kill"),{ids:e}):t.call(this,"delete",this._url.replace(/:id/,e))},o.create=function(e){return t.call(this,"post",this._url.replace(/:id/,"create"),e)},o.byAny=function(e){return t.call(this,"post",this._url.replace(/:id/,"any"),e)},o.index=function(e,r){return t.call(this,"post",this._url.replace(/:id/,"index"),{page:e,chunk:r})},o.select=function(e,r){return t.call(this,"post",this._url.replace(/:id/,"select"),{page:e,chunk:r})},o.query=function(e,t){return r(this.model)},i}]),angular.module("SuhGeneral").factory("shHttpPostQuery",["shDeferredRequest",function(e){var t=function(e){this._query={},this._orderBy=[],this._url="/"+e+"/post-query"},r=t.prototype;return r.by=function(e){return this._query.method=e,this},r.byId=function(e){return this._query.methodParam=e,this},r.orderBy=function(e,t){return this._query.orderBy=this._query.orderBy||[],this._query.orderBy.push([e,t]),this},r.where=function(e,t,r){switch(this._query.where=this._query.where||{},arguments.length){case 2:this._query.where[e]=["=",r];break;case 3:this._query.where[e]=[t,r]}return this},r.whereBetween=function(e,t,r){return this._query.whereBetween=this._query.whereBetween||{},3==arguments.length&&(this._query.whereBetween[e]=[t,r]),this},r.whereIn=function(e,t){return this._query.whereIn=this._query.whereIn||{},2==arguments.length&&(this._query.whereIn[e]=t),this},r.page=function(e){return this._query.page=e,this},r.chunk=function(e){return this._query.chunk=e,this},r.send=function(){return this._query.page=this._query.page||0,this._query.chunk=this._query.chunk||20,e("post",url,this._query)},function(e){return new t(e)}}]),angular.module("SuhGeneral").factory("shHttpQuery",["shDeferredRequest",function(e){var t=function(e){this._orderBy=[],this._url="/"+e+"/search"},r=t.prototype;return r.by=function(e){return this._method=e,this},r.byId=function(e){return this._methodParam=e,this},r.orderBy=function(e,t){var r=t||"asc";return this._orderBy.push(e+":"+r),this},r.where=function(e,t,r){return this._where=this._where||[],"undefined"!=typeof t&&"undefined"!=typeof r?this._where.push([e,t,r]):"undefined"!=typeof t&&this._where.push([e,"=",t]),this},r.orWhere=function(e,t,r){return this._orWhere=this._orWhere||[],"undefined"!=typeof t&&"undefined"!=typeof r?this._orWhere.push([e,t,r]):"undefined"!=typeof t&&this._orWhere.push([e,"=",t]),this},r.whereBetween=function(e,t,r){return this._where=this._where||[],"undefined"!=typeof t&&"undefined"!=typeof r&&this._where.push([e,"between",t,r]),this},r.whereIn=function(e,t){return this._where=this._where||[],"undefined"!=typeof t&&this._where.push([e,"in",t]),this},r.page=function(e){return this._url=this._url.replace(/:p/,e),this},r.chunk=function(e){return this._url=this._url.replace(/:c/,e),this},r.send=function(){var t=this._url;t.lastIndexOf("/")===t.length-1&&(t=t.substr(0,t.length-1));var r=this._where||[],n=this._orWhere||[];return e("post",t,{method:{name:this._method,param:this._methodParam},where:r,orWhere:n,orderBy:this._orderBy})},function(e){return new t(e)}}]),angular.module("SuhGeneral").factory("shIdentityGenerator",[function(){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,r="x"==e?t:3&t|8;return r.toString(16)})}}]),angular.module("SuhGeneral").factory("shLocalizer",["$http","$q","shLOCALE","shUtil",function(e,t,r,n){var i,o={},s=t.defer(),u=!1,a=function(e){o=e,u=!0,s.resolve()},h=function(e){s.resolve("An error has occured")};return i={load:function(t){angular.isString(srouce)?e.get(t).success(a).error(h):angular.isObject(t)&&a(t)},ready:function(){return s.promise},isLoaded:function(){return u},get:function(e,t){var r=n.getDataAt(o,e);return angular.isDefined(r)?i.format(r,t):void 0},format:function(e,t){if(angular.isDefined(t))for(var r in t)e=e.replace(new RegExp(":"+r,"ig"),t[r]);return e}}}]),angular.module("SuhGeneral").factory("shLocationListener",["$location","shException",function(e,t){var r=function(){this._observers=[],this._parts=e.path().match(/[a-zA-Z0-9\-]+/g)};return r.prototype={register:function(e){if(-1===this._observers.indexOf(e)){if("undefined"==typeof e.onLocationChange)throw t(1,"Observer does not implement onLocationChange").toString();this._observers.push(e)}},unregister:function(e){var t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)},_process:function(){if(this._parts=e.path().match(/[a-zA-Z0-9\-]+/g),null!==this._parts&&this._parts.length>0)for(var t=0;t<this._observers.length;t++)this._observers[t].onLocationChange(this._parts[0],this._parts)},get:function(){return this._parts}},new r}]),angular.module("SuhGeneral").factory("shSharedDataRepository",[function(){var e=function(){this.repo={}};return e.prototype={set:function(e,t,r){return this.repo[e]=this.repo[e]||{},this.repo[e][dk]=r,this},get:function(e,t){return this.exists(e,t)?this.repo[e][t]:void 0},exists:function(e,t){return angular.isDefined(this.repo[e])&&angular.isDefined(this.repo[e][t])}},new e}]),angular.module("SuhGeneral").factory("shStorage",[function(){var e=!1,t={isEnabled:function(){return e},store:function(t,r){if(e){if(angular.isObject(t))for(var n in t)localStorage.setItem(n,angular.isObject(t[n])?JSON.stringify(t[n]):t[n]);else localStorage.setItem(t,JSON.stringify(r));return!0}return!1},remove:function(t){e&&(angular.isObject(t)?angular.forEach(t,function(e,t){localStorage.removeItem(t)}):localStorage.removeItem(t))},get:function(t){if(e){var r=localStorage.getItem(t);if(r)return JSON.parse(r)}return void 0},_getType:function(t,r){if(!e)return null;var n=localStorage.getItem(t);return null!==n?r(n):void 0},getInteger:function(e){return t._getType(e,parseInt)},getFloat:function(e){return t._getType(e,parseFloat)},getJSON:function(e){return t._getType(e,JSON.parse)}};return t}]),angular.module("SuhGeneral").factory("shSuccess",[function(){return function(e){return function(t){return t.status?e.resolve(t.result):e.reject(t.reasons)}}}]),angular.module("SuhGeneral").factory("shUrlInspector",["shUrlRules",function(e){var t=document.URL,r={activeRule:null,pieces:[],mode:"view",id:-1,object:null};return{parse:function(){for(var n=0,i=e.rules(),o=i.length,s=null,u=0,a=0;o>n;n++)if(s=t.match(i[n].rule),"undefined"!=typeof s&&null!==s)for(a=i[n].pieces.length;a>u;u++){var h=i[n].pieces[u].split(":");r[h[0]]=s[u+1]||h[1]}r.id=parseInt(r.id)},mode:function(){return r.mode},id:function(){return parseInt(r.id)},object:function(){return r.object}}}]),angular.module("SuhGeneral").factory("shUtil",[function(){var e={extend:function(e,t,r){e.prototype=t.prototype,e.prototype.constructor=t,r&&(e.prototype=angular.extend({},e.prototype,r))},inherits:function(e,t){function r(){}r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e.constructor},proxy:function(e,t){var r=t||this,n=arguments.length>2?Array.prototype.slice.call(agruments,2):[];return function(){var t=Array.prototype.slice.call(arguments,0);return e.apply(r,[].concat(n,t))}},format:function(e,t,r){var n,i;return n=angular.isString(this)?this.slice(0):e,i=angular.isString(this)?e:t,prefix=angular.isString(this)?t:r?r:":$",i&&angular.forEach(i,function(e,t){n=n.replace(angular.isString(t)?prefix.replace(/\$/,t):"?",e)}),n},map:function(e,t){var r=angular.isArray(e)?[]:angular.isObject(e)?[]:"";for(var n in e)r[n]=t(e[n]);return r},extractField:function(t,r){for(var n=angular.isArray(t)?t:this,i=[],o=0,s=n.length,u=-1;s>o;o++)u=e.getDataAt(n[o],r),u&&i.push(u);return i},identify:function(e){return e},filter:function(t,r){var n,i=(e.identity,[]);for(n in t)r(t[n],n,t)&&i.push(t[n]);return i},findIndexByField:function(t,r,n){for(var i=angular.isArray(t)?t:this,o=0,s=i.length;s>o;o++)if(e.getDataAt(i[o],r)==n)return o;return-1},existsByField:function(t,r,n){for(var i=0,o=t.length;o>i;i++)if(e.getDataAt(t[i],r)==n)return!0;return!1},removeByField:function(t,r,n){for(var i=0,o=t.length;o>i;i++)if(e.getDataAt(t[i],r)==n)return t.splice(i,1)[0];return void 0},removeAllByField:function(t,r,n){for(var i=[],o=0,s=t.length;s>o;o++)e.getDataAt(t[o],r)==n&&(i.push(t.splice(o,1)[0]),o--,s--);return i},findAllByField:function(t,r,n){for(var i=angular.isArray(t)?t:this,o=[],s=0,u=i.length;u>s;s++)e.getDataAt(i[s],r)==n&&o.push(i[s]);return o},findByField:function(t,r,n){for(var i=angular.isArray(t)?t:this,o=0,s=i.length;s>o;o++)if(e.getDataAt(i[o],r)==n)return i[o];return void 0},getDataAt:function(e,t){var r=t.match(/[^\.]+/gi),n=angular.isString(e)?this:e,i=0,o=r?r.length:0;for(i=0;o>i&&n;i++)n=n[r[i]];return n},setDataAt:function(e,t,r){var n=t.match(/[^\.]+/gi),i=angular.isString(e)?this:e,o=0,s=n?n.length-1:0;for(o=0;s>o;o++)i=i[n[o]]=i[n[o]]||{};return i[n[s]]=r,i},toSnakeCase:function(e){var t=e.match(/[A-Z]?[a-z0-9]+(?=[A-Z])?/g),r=e,n=t?t.length:0,i=1;if(n>0){for(r=t[0];n>i;i++)r=r+"_"+t[i];r=r.toLowerCase()}return r},toCamelCase:function(t){var r=t.match(/[^\-\_\.]+/g);return r&&r.length>1?r[0].toLowerCase()+e.map(r.slice(1),function(e){return e[0].toUpperCase()+e.slice(1)}).join(""):r[0].toLowerCase()},capitalize:function(e){if(!angular.isString(e))throw new Error("invalid parameter passed, expecting a string");return e.length>1?e[0].toUpperCase()+e.slice(1):e.toUpperCase()},lowerize:function(e){return e.charAt(0).toLowerCase()+e.slice(1)}};return e}]);